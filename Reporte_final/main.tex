% Realizada por César Martínez cesar.martinez@udlap.mx
%VERSION 2.0


\documentclass[12pt]{article}  %tipo de documento y tamaño de letra normal
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%% Paquetes basicos, pueden encontrar información especifica de cada uno de ellos en  (https://www.ctan.org/) %%%%%%%%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[spanish]{babel} %Indica que escribiermos en español
%\usepackage[english]{babel} %Indica que escribiermos en inglés
%Comentar la línea del idiona que NO usarán en su reporte
\usepackage[utf8]{inputenc} %Indica qué codificación se está usando ISO-8859-1(latin1)  o utf8  
\usepackage{amsmath} % Comandos extras para matemáticas (cajas para ecuaciones,etc)
\usepackage{amssymb} % Simbolos matematicos (por lo tanto)
\usepackage{graphicx} % Incluir imágenes en LaTeX
\usepackage{color} % Para colorear texto
\usepackage{subfigure} % subfiguras
\usepackage{enumerate} % enumerar
\usepackage{commath} % funcionalidades extras para diferenciales, integrales,etc (\od, \dif, etc)
\usepackage{cancel} % para cancelar expresiones (\cancelto{0}{x})
\usepackage{float} %Podemos usar el especificador [H] en las figuras para que se queden donde queramos
\usepackage{appendix} %Para crear apendices
\usepackage{xcolor} %Definir colores personalizados
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%% PAQUETES CON OPCIONES ESPECIFICAS PRECARGADAS %%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%% Permitir agregar código, colocarlo en un rectángulo y  numerarlo %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{listings} %Sirve para pegar codigo fuente de programas
\usepackage{caption} %Agregar titulos a los codigos
\DeclareCaptionFont{white}{\color{white}}
\DeclareCaptionFormat{listing}{%
  \parbox{\textwidth}{\colorbox{gray}{\parbox{\textwidth}{#1#2#3}}\vskip-4pt}}
\captionsetup[lstlisting]{format=listing,labelfont=white,textfont=white}
\lstset{frame=lrb,xleftmargin=\fboxsep,xrightmargin=-\fboxsep}
\renewcommand{\lstlistingname}{Código}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Definir márgenes del documento%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 \usepackage{anysize} % Para personalizar el ancho de  los márgenes
\marginsize{2cm}{2cm}{2cm}{2cm} % Izquierda, derecha, arriba, abajo
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Hipervinculos activos y a color %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[colorlinks=true,plainpages=true,citecolor=blue,linkcolor=black]{hyperref}
\usepackage{hyperref} 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%% Encabezado y pie de pagina %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{fancyhdr} 
\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{\footnotesize UDLAP} %encabezado izquierda
\fancyhead[R]{\footnotesize CEM}   % encabezado derecha
\fancyfoot[R]{\footnotesize \curso}  % Pie derecha
\fancyfoot[C]{\thepage}  % centro
\fancyfoot[L]{}  %izquierda
\renewcommand{\footrulewidth}{0.4pt}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%% Carpeta donde se deben colocar las imagenes %%%%%%%%%%%%%%%%%%%%
\graphicspath{{Imagenes/}} %Colocar aqui todas las imagenes del documento pueden estar en formato png, eps o jpg, se recomienda eps para mayor calidad.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%% Termina carga de paquetes %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%% Modificar campos que aparecerán en portada %%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\def\titulo{Reporte final: Máquina expendedora de golosinas}%titulo del documento
\def\materia{Clave materia sección: LRT2022-1} %Clave nombre de la materia y sección
\def\curso{Diseño Digital} %Nombre de la materia para footnote
\def\fecha{27 de Noviembre de 2023} %En formato "dia" de "mes" de "año"
\def\equipo {1}%Verificar en blackboard el número asignado
\def\ida{177516} %Nombre y Id´s de todos los integrantes que hayan trabajado en el proyecto
\def\esta{Jesus Alvarez Sombrerero}
\def\idb{177485}
\def\estb{Iván Estrella Sánchez}
\def\idc{178432}
\def\estc{Fernanda Sofía Ovalle Prado}
\def\idd{177212}
\def\estd{Daniel Yamil Tlilayatzi Muñoz}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document} %Inicia el documento
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% PORTADA %%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%No es necesario modificar ninguna de las siguientes lineas, sólo si el número de estudiantes que conforman su equipo es menor o mayor a 5
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{center}
  \newcommand{\HRule}{\rule{\linewidth}{0.5mm}}
  \thispagestyle{empty}
  \vspace*{-1.5cm}
  \textsc{\huge Universidad de las Américas Puebla}\\[1.5cm]
  \textsc{\LARGE Escuela de ingeniería}\\[1.5cm]
  \textsc{\LARGE Departamento de computación, electrónica y mecatrónica}\\[1.5cm]
  \includegraphics[width=150mm]{UDLAP}  									\vspace*{1cm}														\HRule \\[0.4cm]
  { \huge \bfseries \titulo}\\[0.4cm]
  \HRule \\[1cm]
  { \Large \bfseries \materia}\\[1cm]
  { \Large \bfseries Equipo \equipo}\\[1cm]
  \begin{flushleft} \Large
    \ida \hspace{0.5cm}\esta \\
    \idb \hspace{0.5cm}\estb \\
    \idc \hspace{0.5cm}\estc \\
    \idd \hspace{0.5cm}\estd \\ %Copiar y pegar más líneas si su equipo tiene más de 5 integrantes, eliminar si está formado por menos
  \end{flushleft}
  \vfill
  \begin{center}
    {\Large A \fecha, San Andrés Cholula, Puebla}
  \end{center}
\end{center}							 								\newpage
%%%%%%%%%%%%%%%%%%%% TERMINA PORTADA %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\thispagestyle{empty} %Para no numerar la página del indice
\tableofcontents %Comando que genera el índice
\newpage %Se asegura que el documento inicie en la sigueinte pagina despues del índice
\setcounter{page}{1} %Para comenzaMaquina expendedora de golosinasr a numerar las páginas desde este punto
\section{Objetivo y objetivos particulares}
Programar y simular un circuito secuencial que controle una máquina expendedora.
\subsection{Objetivos particulares}
\begin{itemize}
  \item La máquina debe permitir comprar 5 productos.
  \item La máquina admite monedas de 1, 2, 5 y 10 pesos únicas.
  \item La máquina permite confirmar la compra, además de solicitar el cambio.
  \item La máquina debe tener un botón de reset que igual sirve para cancelar.
  \item Diseñar un circuito que permita la simulación de la máquina.
  \item Programar el circuito en un FPGA Basys 3 utilizando VHDL.
  \item Realizar testbench para verificar el funcionamiento del circuito en EDA Playground.
\end{itemize}

\section*{Materiales}

\subsection*{Equipamiento}

\begin{itemize}
  \item Basys 3 board
\end{itemize}

\subsection*{Software}

\begin{itemize}
  \item Vivado 2022.2
  \item EDA Playground
\end{itemize}

\section{Introducción y Marco Teórico}
El proyecto aborda el diseño y la simulación de un circuito secuencial para controlar una máquina expendedora, utilizando el lenguaje de programación VHDL y el hardware FPGA Basys 3. El objetivo principal es crear un sistema que administre la venta de cinco productos diferentes: picafresa, 3 pesos; ositos, 6 pesos; viboritas, 7 pesos; papas, 12 pesos; jugo, 15 pesos.Este acepta monedas de 1, 2, 5 y 10 pesos que no se repiten. El diseño debe incluir funcionalidades clave, como la confirmación de compra, solicitud de cambio, y un botón de reset que también sirve para cancelar transacciones. Se busca probar todo con un testbench en EDA Playground y luego pasarlo a Vivado para programarlo en el Basys 3.

Un circuito secuencial es un tipo de circuito eléctrico en el que la salida no solo depende de las entradas actuales, sino también del historial de entradas anteriores. A diferencia de los circuitos combinacionales, donde la salida es una función directa de las entradas, los circuitos secuenciales incorporan memoria. Esta memoria se logra mediante el uso de elementos de almacenamiento, como flip-flops o latches, que pueden mantener un estado. Esto permite que el circuito "recuerde" información pasada, lo que es fundamental para la creación de dispositivos como computadoras, donde se necesitan secuencias de operaciones y almacenamiento de datos \cite{7169287}.

Una forma que otros han desarrollado una máquina expendedora en VHDL es mediante la implementación de un controlador que gestiona las entradas monetarias y coordina la dispensación de productos y el cambio. Este enfoque utiliza un conjunto de señales para detectar la inserción de dinero y activa la entrega del artículo una vez que se alcanza la cantidad exacta. Con un diseño que incorpora estados de espera y procesamiento, el sistema asegura una operación fluida y eficiente, ajustando las salidas de la máquina en respuesta a las acciones del usuario. La programación en VHDL permite una descripción precisa del comportamiento del controlador de la máquina expendedora \cite{lameres2019quick}.

Siguiendo el acercamiento de seleccionar de acuerdo a casos, decidimos ir por una programación de asignación de señales condicional, además de utilizar la operación de suma y resta con números, contando igual, con un circuito capaz de hacer display de 7 segmentos. En VHDL, la programación de circuitos que realizan operaciones basadas en señales condicionales a menudo sigue un patrón donde un proceso secuencial verifica el estado de múltiples señales de entrada y realiza cálculos o toma decisiones basadas en esos estados. Cada señal de entrada representa una condición o un valor que, cuando es activado, desencadena una acción dentro del proceso. Por su lado las bibliotecas IEEE.STD\_LOGIC\_ARITH y IEEE.STD\_LOGIC\_UNSIGNED son paquetes adicionales en VHDL que proporcionan funcionalidades para realizar operaciones aritméticas con señales que son de tipo std\_logic\_vector \cite{unlp2018}. Por su lado, un display de 7 segmentos en una Basys 3 debe ser mapeado por código utilizando el reloj, se debe diseñar las asignaciones que se pueden realizar en un display y un controlador que recorra los 4 displays. Posteriormente, se debe definir ese controlador en un archivo .xdc junto a los puertos que se pueden utilizar, los cuales deben ser activados en los tipos de asignaciones que se definen \cite{digilent2023}.

\section{Diagramas}

%En este caso el código puede ser mandado a llamar desde un archivo
\lstinputlisting[language=C,caption=Código desde archivo y en C]{codigos/fast.c}


% En este caso será necesario copiar y pegar todo el código 
\begin{lstlisting}[language=VHDL, caption=Código en VHDL]
  library IEEE;
use IEEE.STD_LOGIC_1164.ALL;
use IEEE.std_logic_unsigned.all;
entity Contador0_9 is
    Port ( clock_100Mhz : in STD_LOGIC;
           reset : in STD_LOGIC;
           Anode_Activate : out STD_LOGIC_VECTOR (3 downto 0);
           LED_out : out STD_LOGIC_VECTOR (6 downto 0);
           Led0: out STD_LOGIC:='0';
           Led1: out std_logic:='0');-- COMMENT
end Contador0_9;
\end{lstlisting}

% En este caso será necesario copiar y pegar todo el código 
\begin{lstlisting}[language=Python, caption=Código en Python]
  def hello(name):
    print 'Hello', name
 
if __name__=='__main__':
    hello('Me')   #COMENTARIO 
\end{lstlisting}


\newpage %Termina la pagina y empieza una nueva
\appendix % A partir de este comando, todas las secciones por venir serán parte del apéndice
\section{Hoja de software}


%%%%%%% Bibliografía %%%%%%%%
\clearpage %Asegura que la bibliografía inicie en una nueva página
\bibliographystyle{bst/IEEEtran} %Estilo de bibliografía
\bibliography{bib/bibliografia} %Fuentes bibliográficas
\addcontentsline{toc}{section}{Referencias}  %Agrega la bilbiogrfía al indice
%%%%%%% Bibliografía %%%%%%%%      
\end{document} %Termina el documento